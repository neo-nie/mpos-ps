<!DOCTYPE html>
<html>
<head>
    <title>业务概况</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <link rel="apple-touch-icon" href="images/icon.png"/>
    <link rel="apple-touch-startup-image" href="images/startup-1024x748.png"/>
    <meta http-equiv="X-UA-Compatible" content="IE=7"/>
    <link rel="Stylesheet" href="../styles/Style.css"/>

    <!--弹出框样式脚本-->
    <link id="artDialog-skin" href="../styles/artDialog-skin/skins/default.css" rel="stylesheet"/>
    <script src="../scripts/jquery/artDialog/artDialog.min.js"></script>
    <script src="../scripts/jquery/artDialog/artDialog.plugins.min.js"></script>
    <script>
        function ShowDialog() {
            art.dialog({
                title:'新建查询',
                lock:true,
                content:"<div><iframe height='70' width='360' scrolling='no' frameborder='0' src='Dialog/BusinessSurveySelect.html'/></div>",
                okValue:'确定',
                ok:function () {
                },
                cancel:function () {
                },
                cancelValue:'取消',
                padding:'5px'
            });
        }
    </script>

    <!--jqgrid-->
    <link rel="stylesheet" type="text/css" media="screen" href="../styles/css/ui-lightness/jquery-ui-1.7.2.custom.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="../scripts/jquery/jqgrid/js/src/css/ui.jqgrid.css"/>
    <script src="../scripts/jquery/jquery-1.7.2.js" type="text/javascript"></script>
    <script src="../scripts/jquery/jqgrid/js/jquery.jqGrid.min.js" type="text/javascript"></script>

    <!--图表控件-->
    <script src="../scripts/js/highcharts.js"></script>
    <script src="../scripts/app.js"></script>
</head>
<body>
<div id="header">
    <a href="../index.html" class="logo_btn">
        <img src="../images/logo_img.jpg" /><span>数据业务生态系统</span></a>
    <span class="back_help">
        <a href="../index.html">导航页</a><span>&nbsp;>&nbsp;</span><a href="javascript:">业务概况</a>
    </span>
    <div id="userinfo">
        <div>
            <span class="username">Admin</span>,欢迎登录系统！<span class="control"><a href="../login.html"><img
                src="../images/exit.png" />注销</a><a href="javascript:" onclick="ShowSetting();"><img src="../images/setting.png" />设置</a></span></div>
    </div>
</div>
<div id="content">
    <div class="selectdiv">
        <a href="javascript:" class="linkbtn" onclick="ShowDialog();"><span>新建查询</span></a><span style="margin: 5px;">当前查询：全网，总体性能，一小时粒度</span>
    </div>
    <div>
        <table width="100%" cellpadding="0" cellspacing="0" border="0" class="main_table">
            <tr>
                <td width="50%">
                    <div style="position: relative;">
                        <div class="chart_div" id="chart_01">
                        </div>
                        <div class="chart_div" id="chart_02">
                        </div>
                        <div class="tab_div" style="position:absolute; left: 3px; top:3px;">
                            <ul id="tab_01" class="tab_ul">
                                <li><a href="javascript:"><span>按流量</span></a></li>
                                <li><a href="javascript:"><span>按用户数</span></a></li>
                            </ul>
                        </div>
                    </div>

                </td>
                <td width="50%">
                    <table id="list1"></table>
                    <!--<div id="gridPager1"></div>-->
                </td>
            </tr>
            <tr>
                <td>
                    <div style="position: relative;">
                        <div class="chart_div" id="chart_03">
                        </div>
                        <div class="chart_div" id="chart_04">
                        </div>
                        <div class="tab_div" style="position:absolute; left: 3px; top:3px;">
                            <ul id="tab_02" class="tab_ul">
                                <li><a href="javascript:"><span>按流量</span></a></li>
                                <li><a href="javascript:"><span>按用户数</span></a></li>
                            </ul>
                        </div>
                    </div>
                </td>
                <td>
                    <table id="list2"></table>
                    <!--<div id="gridPager2"></div>-->
                </td>
            </tr>
        </table>
    </div>
</div>
</body>
</html>
<script type="text/javascript">
$(document).ready(function () {
    $("#chart_01").height(($(window).height() - 100) / 2);
    $("#chart_02").height(($(window).height() - 100) / 2);
    $("#chart_03").height(($(window).height() - 100) / 2);
    $("#chart_04").height(($(window).height() - 100) / 2);

    var chart1;
    var chart2;
    var chart3;
    var chart4;
    chart1 = new Highcharts.Chart({
        chart:{
            renderTo:'chart_01',
            plotBackgroundColor:null,
            plotBorderWidth:null,
            plotShadow:false
        },
        title:{
            text:'热门业务流量分布'
        },
        tooltip:{
            formatter:function () {
                return '<b>' + this.point.name + '</b>: ' + this.percentage + ' %';
            }
        },
        plotOptions:{
            pie:{
                allowPointSelect:true,
                cursor:'pointer',
                dataLabels:{
                    enabled:true,
                    color:'#000000',
                    connectorColor:'#000000'
                }
            }
        },
        series:[
            {
                type:'pie',
                name:'流量',
                data:[
                    ['网页浏览', 14387.13507461],
                    ['即时消息', 3970.04411603],
                    ['手机微博', 603.20663644],
                    ['手机阅读', 579.61735536],
                    ['手机网购', 384.15663433]
                ]
            }
        ]
    });
    chart2 = new Highcharts.Chart({
        chart:{
            renderTo:'chart_02',
            plotBackgroundColor:null,
            plotBorderWidth:null,
            plotShadow:false
        },
        title:{
            text:'热门业务用户数分布'
        },
        tooltip:{
            formatter:function () {
                return '<b>' + this.point.name + '</b>: ' + this.percentage + ' %';
            }
        },
        plotOptions:{
            pie:{
                allowPointSelect:true,
                cursor:'pointer',
                dataLabels:{
                    enabled:true,
                    color:'#000000',
                    connectorColor:'#000000'
                }
            }
        },
        series:[
            {
                type:'pie',
                name:'用户数',
                data:[
                    ['网页浏览', 271141],
                    ['即时消息', 227325],
                    ['手机微博', 13034],
                    ['手机阅读', 7714],
                    ['手机网购', 5636]
                ]
            }
        ]
    });
    chart3 = new Highcharts.Chart({
        chart:{
            renderTo:'chart_03',
            zoomType:'xy'
        },
        title:{
            text:'自有业务流量分布情况'
        },
        //                    subtitle: {
        //                        text: 'Source: WorldClimate.com'
        //                    },
        xAxis:{
            categories:[
                '移动手机阅读',
                '移动梦网',
                '手机飞信',
                '移动快讯',
                '移动游戏',
                '移动手机下载',
                '彩信发送',
                '移动随身听',
                '139邮箱',
                '彩信接收',
                '139微博'
            ],
            labels:{
                style:{
                    fontSize:'12px',
                    fontFamily:'宋体'
                }
            }
        },
        yAxis:[
            { // Primary yAxis
                min:0,
                labels:{
                    formatter:function () {
                        return this.value + 'MB';
                    }
                },
                title:{
                    text:''
                }
            },
            { // Secondary yAxis
                min:0,
                labels:{
                    formatter:function () {
                        return this.value + '%';
                    }
                },
                title:{
                    text:'',
                    maxY:100
                },
                opposite:true
            }
        ],

        plotOptions:{
            column:{
                pointPadding:0.2,
                borderWidth:0
            }
        },
        series:[
            {
                name:'流量MB',
                type:'column',
                data:[232.70499325, 206.47912598, 39.29947186, 19.50275993, 9.48109722, 9.14898109, 8.31381798, 4.63376808, 4.03520107, 2.37511635, 0.49181271]

            },
            {
                name:'同类型流量占比',
                yAxis:1,
                type:'line',
                data:[51.63, 1.165, 1.63, 66.04, 0.41, 59.34, 14.84, 44.53, 0.66, 53.21, 55.47]
            }
        ]
    });
    chart4 = new Highcharts.Chart({
        chart:{
            renderTo:'chart_04',
            zoomType:'xy'
        },
        title:{
            text:'自有业务用户数分布情况'
        },
        //                    subtitle: {
        //                        text: 'Source: WorldClimate.com'
        //                    },
        xAxis:{
            categories:[
                '移动梦网',
                '手机飞信',
                '移动手机阅读',
                '移动快讯',
                '彩信发送',
                '移动手机下载',
                '移动游戏',
                '移动随身听',
                '139邮箱',
                '139微博',
                '彩信接收'
            ],
            labels:{
                style:{
                    fontSize:'12px',
                    fontFamily:'宋体'
                }
            }
        },
        yAxis:[
            { // Primary yAxis
                min:0,
                title:{
                    text:''
                }
            },
            { // Secondary yAxis
                min:0,
                labels:{
                    formatter:function () {
                        return this.value + '%';
                    }
                },
                title:{
                    text:'',
                    maxY:100
                },
                opposite:true
            }
        ],

        plotOptions:{
            column:{
                pointPadding:0.2,
                borderWidth:0
            }
        },
        series:[
            {
                name:'用户数',
                type:'column',
                data:[4877, 2506, 2288, 891, 281, 277, 261, 135, 107, 89, 46]

            },
            {
                name:'同类型用户数占比',
                yAxis:1,
                type:'line',
                data:[7.53, 0.71, 48.46, 1.63, 42.06, 11.36, 53.35, 7.52, 70.07, 5.61, 57.94]
            }
        ]
    });

    //初始化表格一数据
    jQuery("#list1").jqGrid({
        datatype:"local",
        height:'auto',
        shrinkToFit:false,
        autowidth:true,
        colNames:['业务类型', '流量', '用户数', '请求次数', '成功率', '速率(kbps)'],
        colModel:[
            { name:'type', index:'type', width:100 },
            { name:'flow', index:'flow', width:80 },
            { name:'user', index:'user', width:80 },
            { name:'request', index:'request', width:120 },
            { name:'suc_rate', index:'suc_rate', width:100 },
            { name:'rate', index:'rate', width:120}
        ],
//        pager: '#gridPager1',
//        sortname: 'id',
//        viewrecords: true,
//        sortorder: "desc",
//        multiselect: false,
        subGrid:true,
        subGridRowExpanded:function (subgrid_id, row_id) {
            var subgrid_table_id, pager_id;
            subgrid_table_id = subgrid_id + "_t";
            pager_id = "p_" + subgrid_table_id;
            $("#" + subgrid_id).html("<table id='" + subgrid_table_id + "' class='scroll'></table><div id='" + pager_id + "' class='scroll'></div>");
            jQuery("#" + subgrid_table_id).jqGrid({
                datatype:"local",
                shrinkToFit:false,
                autowidth:true,
                colNames:['流量排行', '流量MB', '用户数', '请求次数', '成功率', '速率(kbps)'],
                colModel:[
                    {name:"flowrank", index:"flowrank", width:80},
                    {name:"flowrate", index:"flowrate", width:120},
                    {name:"request_num", index:"request_num", width:80},
                    {name:"user", index:"user", width:80},
                    {name:"suc_rate", index:"suc_rate", width:80},
                    {name:"rate", index:"rate", width:100}
                ],
//                rowNum:20,
//                pager: pager_id,
//                sortname: 'num',
//                sortorder: "asc",
                height:'100%'
            })

            var mydata2 = [
                { flowrank:"3g门户", flowrate:"200", request_num:"300", user:"3000", suc_rate:"88%", rate:"23" },
                { flowrank:"Sina", flowrate:"100", request_num:"190", user:"1900", suc_rate:"80%", rate:"33" },
                { flowrank:"百度", flowrate:"80", request_num:"130", user:"1300", suc_rate:"90%", rate:"53" },
                { flowrank:"凤凰", flowrate:"50", request_num:"100", user:"1000", suc_rate:"88%", rate:"21" },
                { flowrank:"其它", flowrate:"70", request_num:"80", user:"800", suc_rate:"93%", rate:"21" }
            ];
            for (var i = 0; i <= mydata2.length; i++)
                jQuery("#" + subgrid_table_id).addRowData(i + 1, mydata2[i]);

        }
    });
    //    jQuery("#list1").jqGrid('navGrid','#gridPager1',{add:false,edit:false,del:false});

    var mydata1 = [
        { type:"网页浏览", flow:"500", user:"800", request:"8000", suc_rate:"88%", rate:"35" },
        { type:"微博", flow:"280", user:"300", request:"800", suc_rate:"80%", rate:"33" },
        { type:"下载", flow:"100", user:"150", request:"297", suc_rate:"90%", rate:"53" },
        { type:"阅读", flow:"60", user:"100", request:"533", suc_rate:"88%", rate:"21" },
        { type:"视频", flow:"100", user:"20", request:"50", suc_rate:"93%", rate:"70" }
    ];
    for (var i = 0; i <= mydata1.length; i++)
        jQuery("#list1").addRowData(i + 1, mydata1[i]);

    //初始化表格二数据
    jQuery("#list2").jqGrid({
        datatype:"local",
        height:'auto',
        shrinkToFit:false,
        autowidth:true,
        colNames:['业务类型', '流量', '用户', '速率(kbps)', '同类型业务速率', '成功率', '同类型业务成功率'],
        colModel:[
            { name:'type', index:'type', width:80 },
            { name:'flow', index:'flow', width:60 },
            { name:'user', index:'user', width:60 },
            { name:'rate', index:'rate', width:100 },
            { name:'bus_rate', index:'bus_rate', width:120 },
            { name:'suc_rate', index:'suc_rate', width:80 },
            { name:'bus_suc_rate', index:'bus_suc_rate', width:120}
        ]
//        multiselect: false,
//        sortname:'type',
//        sortorder:'asc',
//        viewrecords:true,
//        rowNum:10,
//        rowList:[10,20,30],
//        pager:"#gridPager2"
    });//.navGrid('#gridPager2',{edit:false,add:false,del:false})
    var mydata2 = [
        { type:"飞信", flow:"100", user:"300", rate:"23", bus_rate:"20", suc_rate:"", bus_suc_rate:"" },
        { type:"移动手机电视", flow:"100", user:"120", rate:"53", bus_rate:"48", suc_rate:"90%", bus_suc_rate:"60%" },
        { type:"139邮箱", flow:"50", user:"26", rate:"21", bus_rate:"16", suc_rate:"88%", bus_suc_rate:"80%" },
        { type:"彩信", flow:"33", user:"80", rate:"70", bus_rate:"65", suc_rate:"88%", bus_suc_rate:"80%" },
        { type:"移动梦网", flow:"30", user:"60", rate:"33", bus_rate:"28", suc_rate:"88%", bus_suc_rate:"70%" },
        { type:"139微博", flow:"23", user:"50", rate:"33", bus_rate:"36", suc_rate:"88%", bus_suc_rate:"30%" },
        { type:"移动手机阅读", flow:"22", user:"18", rate:"33", bus_rate:"36", suc_rate:"88%", bus_suc_rate:"20%" },
        { type:"移动游戏", flow:"11", user:"9", rate:"33", bus_rate:"36", suc_rate:"88%", bus_suc_rate:"80%" },
        { type:"移动证券", flow:"5", user:"13", rate:"33", bus_rate:"36", suc_rate:"88%", bus_suc_rate:"80%" }
    ];
    for (var i = 0; i <= mydata2.length; i++)
        jQuery("#list2").addRowData(i + 1, mydata2[i]);

    /*jqgrid自适应窗口宽度*/
    $(function () {
        $("#list1").setGridHeight(($(window).height() - 150) / 2);
        $("#list2").setGridHeight(($(window).height() - 150) / 2);
        $(window).resize(function () {
//            $("#list1").setGridWidth($(window).width() * 0.5);
//            $("#gridPager1").setGridWidth($(window).width()*0.5);
//            $("#list2").setGridWidth($(window).width() * 0.5);
//            $("#gridPager2").setGridWidth($(window).width()*0.5);
        });
    });

    <!--流量、用户数的图表切换-->
    $(function () {
        $('#chart_02').css({display:'none'});
        $('#chart_04').css({display:'none'});
        var node1 = $('#tab_01 li:first-child');
        var node2 = $('#tab_02 li:first-child');
        node1.addClass('current');
        node2.addClass('current');
        $('#tab_01 li').click(function () {
            node1.removeClass('current');
            $(this).addClass('current');
            node1 = $(this);
            if ($(this).is('#tab_01 li:nth-child(1)')) {
                $('#chart_01').css({display:'block'});
                $('#chart_02').css({display:'none'});
            }
            else if ($(this).is('#tab_01 li:nth-child(2)')) {
                $('#chart_01').css({display:'none'});
                $('#chart_02').css({display:'block'});
            }
        })
        $('#tab_02 li').click(function () {
            node2.removeClass('current');
            $(this).addClass('current');
            node2 = $(this);
            if ($(this).is('#tab_02 li:nth-child(1)')) {
                $('#chart_03').css({display:'block'});
                $('#chart_04').css({display:'none'});
            }
            else if ($(this).is('#tab_02 li:nth-child(2)')) {
                $('#chart_03').css({display:'none'});
                $('#chart_04').css({display:'block'});
            }
        })
    })
});
</script>

